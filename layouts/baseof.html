<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en" }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ block "title" . }}{{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ block "meta_description" . }}{{ .Site.Params.description }}{{ end }}">
  {{- with .Params.noindex }}
  <meta name="robots" content="noindex">
  {{- end }}
  <link rel="icon" href="/favicon.ico" sizes="48x48">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="preload" href="/fonts/source-code-pro-latin.woff2" as="font" type="font/woff2" crossorigin>
  {{- with .Site.Params.analyticsSrc }}
  {{- $u := urls.Parse . }}
  <link rel="preconnect" href="{{ $u.Scheme }}://{{ $u.Host }}" crossorigin>
  {{- end }}
  <!-- OpenGraph -->
  <meta property="og:site_name" content="{{ .Site.Title }}">
  <meta property="og:title" content="{{ block "og_title" . }}{{ .Site.Title }}{{ end }}">
  <meta property="og:description" content="{{ block "og_description" . }}{{ .Site.Params.description }}{{ end }}">
  <meta property="og:type" content="{{ block "og_type" . }}website{{ end }}">
  <meta property="og:url" content="{{ replace .Permalink "/index.html" "/" }}">
  <meta property="og:image" content="{{ block "og_image" . }}{{ ((.Site.Params.ogImage) | default .Site.Params.photo) | absURL }}{{ end }}">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  {{- with .Site.Params.twitter }}
  <meta name="twitter:site" content="{{ . }}">
  {{- end }}
  <script>
    (function(){var t=localStorage.getItem('theme');if(t==='dark'||(t!=='light'&&matchMedia('(prefers-color-scheme:dark)').matches))document.documentElement.classList.add('dark')})();
  </script>
  {{- $css := resources.Get "css/style.css" -}}
  <link rel="stylesheet" href="{{ $css.RelPermalink }}?v={{ $css.Content | md5 }}">
  {{- $js := resources.Get "js/main.js" -}}
  <script src="{{ $js.RelPermalink }}?v={{ $js.Content | md5 }}" type="module"></script>
  {{- with .Site.Params.analyticsID }}
  <script data-website-id="{{ . }}" defer src="{{ $.Site.Params.analyticsSrc }}"></script>
  {{- end }}
  {{- range .Site.Params.alternates }}
  <link rel="alternate" hreflang="{{ .hreflang }}" href="{{ .href }}">
  {{- end }}
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feed.xml">
  {{- with .OutputFormats.Get "md" }}
  <link rel="alternate" type="{{ .MediaType }}" href="{{ .RelPermalink }}">
  {{- end }}
  {{- $cleanPath := replace (replace .RelPermalink "/index.html" "/" ) ".html" "" -}}
  {{- $isHome := or (eq $cleanPath "/") (eq .RelPermalink "/") -}}
  {{- $isBlogList := or (eq $cleanPath "/blog") (eq $cleanPath "/blog/") -}}
  {{- $isBlogPost := and (not $isHome) (not $isBlogList) (hasPrefix $cleanPath "/blog/") -}}
  {{- $blogPostSlug := replace (replace $cleanPath "/blog/" "") "/" "" -}}
  {{- $isTagList := or (eq $cleanPath "/tags") (eq $cleanPath "/tags/") -}}
  {{- $isTagSingle := and (not $isTagList) (hasPrefix $cleanPath "/tags/") -}}
  {{- $tagSlug := replace (replace $cleanPath "/tags/" "") "/" "" -}}
  {{- $pageSlug := replace (replace $cleanPath "/" "") "/" "" -}}
  <!-- Breadcrumb structured data (Google SEO) -->
  {{- if not $isHome }}
  <script type="application/ld+json">
  {{- $items := slice (dict "position" 1 "name" (T "breadcrumb_home") "item" (.Site.BaseURL | strings.TrimRight "/")) -}}
  {{- if $isBlogList -}}
    {{- $items = $items | append (dict "position" 2 "name" (T "breadcrumb_blog") "item" ("blog/" | absURL | strings.TrimRight "/")) -}}
  {{- else if $isBlogPost -}}
    {{- $items = $items | append (dict "position" 2 "name" (T "breadcrumb_blog") "item" ("blog/" | absURL | strings.TrimRight "/")) -}}
    {{- $items = $items | append (dict "position" 3 "name" .Title "item" (.Permalink | strings.TrimRight "/")) -}}
  {{- else if $isTagList -}}
    {{- $items = $items | append (dict "position" 2 "name" (T "breadcrumb_blog") "item" ("blog/" | absURL | strings.TrimRight "/")) -}}
    {{- $items = $items | append (dict "position" 3 "name" (T "breadcrumb_tags") "item" ("tags/" | absURL | strings.TrimRight "/")) -}}
  {{- else if $isTagSingle -}}
    {{- $items = $items | append (dict "position" 2 "name" (T "breadcrumb_blog") "item" ("blog/" | absURL | strings.TrimRight "/")) -}}
    {{- $items = $items | append (dict "position" 3 "name" (T "breadcrumb_tags") "item" ("tags/" | absURL | strings.TrimRight "/")) -}}
    {{- $items = $items | append (dict "position" 4 "name" .Title "item" (.Permalink | strings.TrimRight "/")) -}}
  {{- else -}}
    {{- $items = $items | append (dict "position" 2 "name" .Title "item" (.Permalink | strings.TrimRight "/")) -}}
  {{- end -}}
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {{- range $i, $el := $items -}}
      {{ if $i }},{{ end }}
      {
        "@type": "ListItem",
        "position": {{ $el.position }},
        "name": {{ $el.name | jsonify }},
        "item": {{ $el.item | jsonify }}
      }
      {{- end -}}
    ]
  }
  </script>
  {{- end }}
</head>

<body class="min-h-screen text-neutral-800 dark:text-neutral-200 antialiased bg-site-gradient">

  <!-- Sticky Top Bar -->
  <div class="lg:sticky lg:top-0 z-50 bg-white/80 dark:bg-neutral-900/80 lg:backdrop-blur-sm border-b border-neutral-200 dark:border-neutral-700">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">
      <div class="flex items-center h-10 font-mono text-sm text-neutral-400 dark:text-neutral-500">
        {{- if $isHome -}}
          <span class="text-neutral-700 dark:text-neutral-300 font-medium"><span class="hidden sm:inline">{{ .Site.Params.domain }}:</span>~</span>
        {{- else -}}
          <a href="/" class="text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors no-underline"><span class="hidden sm:inline">{{ .Site.Params.domain }}:</span>~</a>
          {{- if $isBlogList -}}
            <span class="text-neutral-700 dark:text-neutral-300 font-medium">/blog</span>
          {{- else if $isBlogPost -}}
            <a href="/blog/" class="text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors no-underline">/blog</a>
            <span class="text-neutral-700 dark:text-neutral-300 font-medium inline-block max-w-[40ch] lg:max-w-none truncate align-bottom">/{{ $blogPostSlug }}</span>
          {{- else if $isTagList -}}
            <a href="/blog/" class="text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors no-underline">/blog</a>
            <span class="text-neutral-700 dark:text-neutral-300 font-medium">/tags</span>
          {{- else if $isTagSingle -}}
            <a href="/blog/" class="text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors no-underline">/blog</a>
            <a href="/tags/" class="text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors no-underline">/tags</a>
            <span class="text-neutral-700 dark:text-neutral-300 font-medium">/{{ $tagSlug }}</span>
          {{- else -}}
            <span class="text-neutral-700 dark:text-neutral-300 font-medium">/{{ $pageSlug }}</span>
          {{- end -}}
        {{- end -}}
        <span class="text-neutral-300 dark:text-neutral-600">$</span>
        <button id="theme-toggle" class="ml-auto text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors cursor-pointer" title="{{ T "toggle_theme" }}" aria-label="{{ T "toggle_theme" }}">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
          <svg class="w-4 h-4 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
          <svg class="w-4 h-4 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Header -->
  <div class="lg:hidden px-6 pt-6 pb-5 border-b border-neutral-100 dark:border-neutral-800 text-center">
    <div class="mb-3">
      <a href="/" class="no-underline"><img alt="{{ .Site.Title }}" src="/{{ .Site.Params.photo }}" width="1024" height="1024" class="w-16 h-16 rounded-full object-cover border-2 border-neutral-200 dark:border-neutral-700 mx-auto mb-3"></a>
      <a href="/" class="font-mono text-lg font-bold text-neutral-900 dark:text-neutral-100 lowercase cursor block no-underline hover:no-underline">{{ .Site.Title }}</a>
      <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1">{{ .Site.Params.subtitle }}</p>
      {{- with .Site.Params.affiliationHTML }}
      <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-0.5">{{ . | safeHTML }}</p>
      {{- end }}
    </div>
    <div class="flex items-center justify-center gap-3 flex-wrap mt-3">
      {{ range $i, $link := .Site.Params.nav }}
      {{ if $i }}<span class="text-neutral-300 dark:text-neutral-600">&middot;</span>{{ end }}
      <a href="{{ $link.url }}" class="text-sm text-neutral-500 dark:text-neutral-400 hover:text-accent transition-colors">{{ $link.name }}</a>
      {{ end }}
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-6 lg:px-8">
    <div class="lg:grid lg:grid-cols-[270px_1fr] lg:gap-16 lg:gap-20">

      <!-- Desktop Sidebar -->
      <aside class="hidden lg:block sticky top-10 self-start pt-8 lg:pt-12 max-h-screen overflow-y-auto">
        <div>

          <!-- Identity -->
          <div class="mb-8">
            <a href="/" class="no-underline"><img alt="{{ .Site.Title }}" src="/{{ .Site.Params.photo }}" width="1024" height="1024" class="w-full aspect-square rounded-full object-cover border-2 border-neutral-200 dark:border-neutral-700 mb-4"></a>
            <a href="/" class="font-mono text-lg font-bold text-neutral-900 dark:text-neutral-100 lowercase cursor block no-underline hover:no-underline">{{ .Site.Title }}</a>
            <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-2">{{ .Site.Params.subtitle }}</p>
            {{- with .Site.Params.affiliationHTML }}
            <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-0.5">{{ . | safeHTML }}</p>
            {{- end }}
          </div>

          <!-- Navigation -->
          {{ with .Site.Params.nav }}
          <div class="mb-6">
            <p class="font-mono text-xs text-neutral-300 dark:text-neutral-600 mb-2">// {{ T "nav_label" }}</p>
            <div class="space-y-1">
              {{ range . }}
              <a href="{{ .url }}" class="text-sm text-neutral-500 dark:text-neutral-400 hover:text-accent transition-colors block">{{ .name }}</a>
              {{ end }}
            </div>
          </div>
          {{ end }}

          <!-- Elsewhere -->
          {{ with .Site.Params.elsewhere }}
          <div class="mb-6">
            <p class="font-mono text-xs text-neutral-300 dark:text-neutral-600 mb-2">// {{ T "elsewhere_label" }}</p>
            <div class="space-y-1">
              {{ range . }}
              <a href="{{ .url }}" class="text-sm text-neutral-500 dark:text-neutral-400 hover:text-accent transition-colors block">{{ .name }}</a>
              {{ end }}
            </div>
          </div>
          {{ end }}

          <!-- Connect -->
          {{ with .Site.Params.social }}
          <div class="mb-6">
            <p class="font-mono text-xs text-neutral-300 dark:text-neutral-600 mb-3">// {{ T "connect_label" }}</p>
            <div class="flex items-center gap-3">
              {{ range . }}
              <a href="{{ .url }}" class="text-neutral-400 dark:text-neutral-500 hover:text-accent transition-colors no-underline" title="{{ .name }}" aria-label="{{ .name }}">{{ partial "icons/social-icon.html" (dict "icon" .icon "class" "w-[18px] h-[18px]") }}</a>
              {{ end }}
              <a href="/blog/feed.xml" class="text-neutral-400 dark:text-neutral-500 hover:text-accent transition-colors no-underline" title="{{ T "rss" }}" aria-label="{{ T "rss" }}">{{ partial "icons/social-icon.html" (dict "icon" "rss" "class" "w-[18px] h-[18px]") }}</a>
            </div>
          </div>
          {{ end }}

          <!-- Book a Chat -->
          {{- with .Site.Params.ctaLabel }}
          <a href="{{ $.Site.Params.ctaURL }}" class="inline-block font-mono text-xs text-accent border border-accent px-4 py-2 hover:bg-accent hover:text-white transition-colors no-underline">{{ . }}</a>
          {{- end }}
        </div>
      </aside>

      <!-- Main Content -->
      <main class="min-w-0 max-w-2xl mx-auto lg:mx-0 py-8 lg:py-12">
        {{ block "content" . }}{{ end }}
      </main>
    </div>
  </div>

  <!-- Footer -->
  <footer class="border-t border-neutral-200 dark:border-neutral-700 mt-8 bg-white/80 dark:bg-neutral-900/80">
    <div class="max-w-7xl mx-auto px-6 lg:px-8 py-6 text-center flex flex-col items-center gap-0">
      <div class="hidden lg:flex items-center justify-center gap-2 flex-wrap h-8">
        {{ range $i, $link := .Site.Params.elsewhere }}
        {{ if $i }}<span class="text-neutral-300 dark:text-neutral-600">&middot;</span>{{ end }}
        <a href="{{ $link.url }}" class="text-xs text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors">{{ $link.name }}</a>
        {{ end }}
      </div>
      <div class="flex lg:hidden items-center justify-center gap-2 flex-wrap h-8">
        {{- $n := 0 -}}
        {{ range .Site.Params.elsewhere }}{{ if .footer }}
        {{ if $n }}<span class="text-neutral-300 dark:text-neutral-600">&middot;</span>{{ end }}
        <a href="{{ .url }}" class="text-xs text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors">{{ .name }}</a>
        {{- $n = add $n 1 -}}
        {{ end }}{{ end }}
      </div>
      <p class="font-mono text-xs text-neutral-400 dark:text-neutral-500 h-8 flex items-center gap-2">&copy; {{ now.Format "2006" }} {{ .Site.Title }}{{ with .Site.Params.ctaLabel }} <span class="text-neutral-300 dark:text-neutral-600 lg:hidden">&middot;</span> <a href="{{ $.Site.Params.ctaURL }}" class="lg:hidden font-mono text-xs text-accent hover:text-accent transition-colors">{{ . }}</a>{{ end }}</p>
      <div class="flex items-center justify-center gap-3 h-8">
        {{ range .Site.Params.social }}
        <a href="{{ .url }}" class="text-neutral-300 dark:text-neutral-600 hover:text-accent transition-colors no-underline" title="{{ .name }}" aria-label="{{ .name }}">{{ partial "icons/social-icon.html" (dict "icon" .icon "class" "w-4 h-4") }}</a>
        {{ end }}
        <a href="/blog/feed.xml" class="text-neutral-300 dark:text-neutral-600 hover:text-accent transition-colors no-underline" title="{{ T "rss" }}" aria-label="{{ T "rss" }}">{{ partial "icons/social-icon.html" (dict "icon" "rss" "class" "w-4 h-4") }}</a>
      </div>
    </div>
  </footer>

  <script>
    (function() {
      var btn = document.getElementById('theme-toggle');
      var states = ['system', 'light', 'dark'];
      var current = localStorage.getItem('theme') || 'system';
      function apply(mode) {
        current = mode;
        var dark = mode === 'dark' || (mode === 'system' && matchMedia('(prefers-color-scheme:dark)').matches);
        document.documentElement.classList.toggle('dark', dark);
        btn.querySelectorAll('svg').forEach(function(svg, i) {
          svg.classList.toggle('hidden', states[i] !== mode);
        });
        if (mode === 'system') localStorage.removeItem('theme');
        else localStorage.setItem('theme', mode);
      }
      btn.addEventListener('click', function() {
        apply(states[(states.indexOf(current) + 1) % 3]);
      });
      apply(current);
      matchMedia('(prefers-color-scheme:dark)').addEventListener('change', function() {
        if (current === 'system') apply('system');
      });
    })();
  </script>

</body>
</html>
